@model IEnumerable<Core.Models.Car>

@{
    ViewData["Title"] = "Index";
}

<h1>Cars</h1>

<form asp-action="Index" method="get">
    <div class="form-row mb-3">
        <div class="col-2">
            <label for="filter">Search</label>
            <div class="input-group no-color">
                <input type="text" class="form-control" id="search" name="search" value="@ViewData["SearchFilter"]" />
            </div>
        </div>

        <div class="col-md-2 ">
            <label class="control-label">Brand</label>
            <div class="input-group">
                <select id="brand-select"
                        name="brandfilter"
                        class="custom-select "
                        asp-for="@ViewData["BrandFilter"]"
                        asp-items="@ViewBag.BrandId">
                    <option value="">All</option>
                </select>
                <div class="input-group-append">
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <label class="control-label">Model</label>
            <div class="input-group">
                <select id="model-select"
                        name="modelfilter"
                        class="custom-select "
                        asp-for="@ViewData["ModelFilter"]">
                    <option value="">All</option>
                </select>
                <div class="input-group-append">
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <label class="control-label">Company</label>
            <div class="input-group">
                <select id="company-select"
                        name="companyfilter"
                        class="custom-select "
                        asp-for="@ViewData["CompanyFilter"]"
                        asp-items="@ViewBag.CompanyId">
                    <option value="">All</option>
                </select>
                <div class="input-group-append">
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <label for="filter">Status</label>
            <div class="input-group no-color">
                <select id="status-select"
                        name="statusfilter"
                        class="custom-select "
                        asp-for="@ViewData["StatusFilter"]"
                        asp-items="@Html.GetEnumSelectList<Core.Enums.StatusEnum>()">
                    <option value="">All</option>
                </select>
                <div class="input-group-append">
                    <button type="submit" class="btn btn-info">Filter</button>
                </div>
            </div>
        </div>

        <div class="col-md-1 mt-auto">
            <a class="btn btn-success" asp-action="Create">New</a>
        </div>

    </div>
</form>

<table class="table table-striped table-hover table-sm">
    <thead class="thead-dark">
        <tr class="d-flex">
            <th class="col-2">
                @Html.DisplayNameFor(model => model.LicenseNumber)
            </th>
            <th class="col-2">
                @Html.DisplayNameFor(model => model.Model.Brand)
            </th>
            <th class="col-2">
                @Html.DisplayNameFor(model => model.Model)
            </th>
            <th class="col-2">
                @Html.DisplayNameFor(model => model.Owner)
            </th>
            <th class="col-2">
                @Html.DisplayNameFor(model => model.Status)
            </th>
            <th class="col-2">

            </th>
        </tr>
    </thead>
    <tbody class="border">
        @foreach (var item in Model)
        {
            <tr class="d-flex">
                <td class="col-2">
                @Html.ActionLink(item.LicenseNumber, "Details", new { id = item.CarId })
                </td>
                <td class="col-2">
                    @Html.DisplayFor(modelItem => item.Model.Brand.Name)
                </td>
                <td class="col-2">
                    @Html.DisplayFor(modelItem => item.Model.Name)
                </td>
                <td class="col-2">
                    @Html.DisplayFor(modelItem => item.Owner.Name)
                </td>
                <td class="col-2">
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td class="col-2">
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts {

    <script>
        $(document).ready(function () {

            $('#brand-select').change(getModels);

            function getModels() {
                let actionUrl = "/Api/ModelsApiEndpoint/GetModelByBrand?id=";
                let brandId = $('#brand-select').val();
                let modelSelect = $('#model-select');

                $.post({
                    url: actionUrl + brandId,
                    success: (data) => {
                        modelSelect.empty();
                        modelSelect.append($('<option></option>').val("").html('All'));
                        $.each(data.data, function (i, item) {
                            modelSelect.append($('<option></option>').val(item.modelId).html(item.name));
                        });
                    },
                    error: (data) => {
                        console.log('Failed');
                        console.log(data);
                    }
                });
            }
        });
    </script>
}